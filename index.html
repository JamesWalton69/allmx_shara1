<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday!</title>
  <style>
    :root{
      --bg:#0b1020; --accent:#ffcb6b; --white:#ffffff; --muted:#9aa3b2;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,var(--bg),#071022);color:var(--white);}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}

    .card{width:980px;max-width:96vw;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:16px;padding:28px;box-shadow:0 10px 30px rgba(2,6,23,0.6);overflow:hidden}

    header{display:flex;gap:18px;align-items:center}
    .avatar{width:120px;height:120px;border-radius:12px;flex:0 0 120px;overflow:hidden;border:3px solid rgba(255,255,255,0.06)}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{flex:1}
    .meta h1{margin:0;font-size:24px}
    .meta p{margin:4px 0;color:var(--muted)}

    .stage{margin-top:20px;display:grid;grid-template-columns:1fr 360px;gap:22px}
    @media (max-width:920px){.stage{grid-template-columns:1fr} .side{order:2}}

    .main-stage{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;min-height:420px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}

    /* Candle area */
    .candle-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
    .cake{width:240px;height:140px;background:linear-gradient(180deg,#f6c6a0,#d88b64);border-radius:12px;position:relative;display:flex;align-items:flex-start;justify-content:center}
    .flame{position:absolute;top:-28px;width:36px;height:48px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
    .flame .inner{width:12px;height:24px;border-radius:12px;animation:flame 800ms infinite}
    @keyframes flame{0%{transform:translateY(0) scale(1)}50%{transform:translateY(-4px) scale(1.04)}100%{transform:translateY(0) scale(1)}}

    /* Main reveal */
    .reveal-photo{position:absolute;inset:18px;border-radius:10px;background:#000;display:grid;place-items:center;opacity:0;pointer-events:none;transition:opacity .9s ease}
    .reveal-photo.visible{opacity:1;pointer-events:auto}
    .reveal-photo img{max-width:100%;max-height:100%;object-fit:cover;border-radius:8px}

    /* Collage ring */
    .collage{position:absolute;right:-70px;top:20px;width:300px;height:300px;pointer-events:none}
    .ring{width:100%;height:100%;border-radius:50%;position:relative;transform-origin:center center}
    .ring img{width:72px;height:72px;object-fit:cover;border-radius:8px;position:absolute;left:50%;top:50%;transform-origin:-120px -120px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .ring.spin{animation:spin 18s linear infinite}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

    /* Sidebar */
    .side{background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;max-height:520px;overflow:auto}
    .info{display:flex;flex-direction:column;gap:8px}
    .info .row{display:flex;justify-content:space-between;color:var(--muted);padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}

    /* letter box */
    .letter{margin-top:14px;background:#fff;color:#000;border-radius:10px;padding:18px;min-height:140px;font-family:Georgia, 'Times New Roman', serif;box-shadow:0 10px 30px rgba(2,6,23,0.25);position:relative}
    .typing{white-space:pre-wrap;font-size:15px;line-height:1.5;min-height:100px}

    /* controls */
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;cursor:pointer;color:#111;font-weight:600}

    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}

    /* small helper */
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="avatar"><img id="thumb" src="assets/pic1.jpg" alt="avatar"></div>
        <div class="meta">
          <h1 id="title">Happy Birthday!</h1>
          <p id="subtitle">Loading details...</p>
        </div>
      </header>

      <div class="stage">
        <div class="main-stage">

          <div class="candle-wrap" id="candleArea">
            <div class="flame" id="flame" title="Click or tap to blow the candle">
              <div class="inner" style="background: radial-gradient(circle at 30% 20%, #ffd96b, #ff8f3b);"></div>
            </div>
            <div class="cake"></div>
            <div class="hint" style="color:var(--muted);font-size:13px;margin-top:8px">Click/tap the flame to blow the candle and start the celebration.</div>
          </div>

          <div class="reveal-photo" id="reveal">
            <img id="mainPhoto" src="assets/pic1.jpg" alt="main">
          </div>

          <div class="collage" aria-hidden="true">
            <div class="ring" id="ring"></div>
          </div>

          <audio id="bgMusic" src="assets/music.mp3" preload="auto"></audio>
        </div>

        <aside class="side">
          <div class="info">
            <div class="row"><strong>Name</strong><span id="info-name">‚Äî</span></div>
            <div class="row"><strong>DOB</strong><span id="info-dob">‚Äî</span></div>
            <div class="row"><strong>Gender</strong><span id="info-gender">‚Äî</span></div>
            <div class="row"><strong>Relation</strong><span id="info-relation">‚Äî</span></div>
            <div class="row"><strong>Age (calculated)</strong><span id="info-age">‚Äî</span></div>
            <div class="row"><strong>Today</strong><span id="today">‚Äî</span></div>
          </div>

          <div class="letter" id="letterBox">
            <div class="typing" id="typing">(Letter will appear here after the candle is blown)</div>
          </div>

          <div class="controls">
            <button class="btn" id="replayBtn">Replay</button>
            <button class="btn" id="muteBtn">Mute</button>
          </div>
        </aside>
      </div>

      <footer>Made with ‚ù§Ô∏è From Riddhiman Ghosh üôÇüòä</footer>
    </div>
  </div>

<script>
// Utility: parse simple key = value file
async function fetchText(path){try{const r=await fetch(path); if(!r.ok) throw new Error('not found'); return await r.text();}catch(e){return null}}

function parseKeyValue(text){const lines = (text||'').split(/[\r\n]+/).map(l=>l.trim()).filter(Boolean); const out={}; for(const line of lines){const m=line.match(/^\s*([^=]+)=\s*(.*)$/); if(m){out[m[1].trim()] = m[2].trim()} } return out }

function calcAge(dobStr){try{ // accept formats like YYYY-MM-DD or DD/MM/YYYY
  if(!dobStr) return '‚Äî';
  let d=null;
  if(/\d{4}-\d{2}-\d{2}/.test(dobStr)) d=new Date(dobStr);
  else if(/\d{1,2}\/\d{1,2}\/\d{4}/.test(dobStr)){const [dd,mm,yy]=dobStr.split('/').map(Number); d=new Date(yy,mm-1,dd)}
  else d=new Date(dobStr);
  if(isNaN(d)) return 'Unknown';
  const today=new Date(); let age=today.getFullYear()-d.getFullYear(); const m=today.getMonth()-d.getMonth(); if(m<0|| (m===0 && today.getDate()<d.getDate())) age--; return age;
}catch(e){return 'Unknown'}}

// Load data and letter
async function init(){
  const dataText = await fetchText('assets/data');
  const data = parseKeyValue(dataText);
  const name = data.name || data.Name || 'Friend';
  const dob = data.DOB || data.dob || data.DOB || '';
  const gender = data.gender || data.Gender || '‚Äî';
  const relation = data['what belongs to me'] || data.relation || data.Relation || 'Friend';

  document.getElementById('info-name').textContent = name;
  document.getElementById('info-dob').textContent = dob || '‚Äî';
  document.getElementById('info-gender').textContent = gender;
  document.getElementById('info-relation').textContent = relation;
  document.getElementById('title').textContent = `Happy Birthday, ${name}!`;
  document.getElementById('subtitle').textContent = `Wishing ${name} the best on their special day.`;
  document.getElementById('today').textContent = new Date().toDateString();
  document.getElementById('info-age').textContent = calcAge(dob);

  // load letter
  const letter = await fetchText('assets/letter.txt') || '(No letter.txt found in assets)';
  window.__LETTER_TEXT = letter;

  // prepare collage
  const ring = document.getElementById('ring');
  // assume pics pic2..pic10 (9 images) exist
  const imgs = [];
  for(let i=2;i<=10;i++){imgs.push(`assets/pic${i}.jpg`)}
  // create positions
  const N=imgs.length; const R=110; // radius
  imgs.forEach((src,i)=>{
    const img = document.createElement('img'); img.src = src; img.alt = `pic${i+2}`; // allow 404s silently
    const angle = (i/N)*Math.PI*2; img.style.transform = `translate(-50%,-50%) rotate(${angle}rad) translate(${R}px) rotate(${ -angle }rad)`;
    ring.appendChild(img);
  });

  // update thumb and mainPhoto
  document.getElementById('thumb').src = 'assets/pic1.jpg';
  document.getElementById('mainPhoto').src = 'assets/pic1.jpg';
}

// Typing effect
function typeText(node, text, speed=28){node.textContent=''; let i=0; return new Promise(resolve=>{ const t=setInterval(()=>{ if(i>=text.length){ clearInterval(t); resolve(); } else { node.textContent += text[i++]; } }, speed) }) }

// Celebration sequence when candle is blown
async function celebrate(){
  const flame = document.getElementById('flame'); if(!flame) return;
  // extinguish visual
  flame.style.opacity=0; flame.style.transform='translateY(6px) scale(.9)';
  // reveal main photo
  const reveal = document.getElementById('reveal'); reveal.classList.add('visible');
  // play music
  const music = document.getElementById('bgMusic'); try{ await music.play() }catch(e){ /* autoplay blocked; user may press play */ }
  // start collage spin
  document.getElementById('ring').classList.add('spin');
  // show letter typing
  const typingNode = document.getElementById('typing');
  typingNode.textContent='';
  const letter = window.__LETTER_TEXT || '(No letter found)';
  await new Promise(r=>setTimeout(r,600));
  await typeText(typingNode, letter, 24);
}

// flame interaction: click/tap or quick mouse move counts as blow
function setupFlame(){
  const flame = document.getElementById('flame'); let blown=false;
  flame.addEventListener('click',()=>{ if(blown) return; blown=true; celebrate(); });
  // also support swipe/hover gust (for touch/mouse)
  let lastY=null; document.addEventListener('mousemove',(e)=>{ if(!lastY) lastY=e.clientY; if(e.clientY - lastY < -30){ if(!blown){ blown=true; celebrate(); } } lastY=e.clientY; });
  // touch
  let touchStartY=null; document.addEventListener('touchstart',e=>{ touchStartY = e.touches[0].clientY; });
  document.addEventListener('touchmove',e=>{ if(touchStartY==null) return; const diff = e.touches[0].clientY - touchStartY; if(diff < -20 && !blown){ blown=true; celebrate(); } });
}

// Controls
function setupControls(){
  document.getElementById('replayBtn').addEventListener('click',()=>{ // reset
    document.getElementById('flame').style.opacity=1; document.getElementById('flame').style.transform='';
    document.getElementById('reveal').classList.remove('visible'); document.getElementById('ring').classList.remove('spin');
    document.getElementById('typing').textContent='(Letter will appear here after the candle is blown)';
    const music=document.getElementById('bgMusic'); music.pause(); music.currentTime=0;
  });
  const mute = document.getElementById('muteBtn'); mute.addEventListener('click',()=>{ const m=document.getElementById('bgMusic'); m.muted = !m.muted; mute.textContent = m.muted? 'Unmute' : 'Mute'; });
}

// init
setupFlame(); setupControls(); init();

// friendly fallback for missing files
window.addEventListener('error',(ev)=>{ /* ignore broken image logs in console */ })
</script>
</body>
</html>

